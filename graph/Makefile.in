# This is the Makefile for graph, a program which generates plot files in
# any of several formats, depending on which plotting library is linked
# with it.  graph, graph-tek, graph-fig, graph-ps, and graph-X are the
# executables.  

VERSION = @VERSION@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH  = @srcdir@

SHELL = /bin/sh

CC = @CC@
CFLAGS = @CFLAGS@
X_CFLAGS = @X_CFLAGS@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
LDFLAGS = @LDFLAGS@
X_LIBS = @X_LIBS@
X_PRE_LIBS = @X_PRE_LIBS@
XLIBS = @XLIBS@
X_EXTRA_LIBS = @X_EXTRA_LIBS@
LIBS = @LIBS@
RANLIB = @RANLIB@
NO_X = @no_x@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
infodir = @infodir@
libdir = @libdir@
includedir = @includedir@
oldincludedir = @oldincludedir@

#----------------------------------------------------------------

GRAPH = graph graph-tek graph-fig graph-ps
GRAPHX = graph-X

SRCS = graph.c reader.c misc.c plotter.c 
OBJSPLUS = graphlist.o reader.o misc.o plotter.o
OBJSMINUS = graphnolist.o reader.o misc.o plotter.o
INCLUDES=-I.. -I$(top_srcdir)/include -I$(top_srcdir)/getopt

GETOPT=../getopt

all: $(GRAPH)
	if test "$(NO_X)" != "yes"; then \
			for i in $(GRAPHX); do $(MAKE) $$i; done; \
	fi

.PHONY: all install uninstall clean realclean distclean

.SUFFIXES:
.SUFFIXES: .c .o

.c.o:
	$(CC) -DVERSION=\"$(VERSION)\" $(CFLAGS) $(INCLUDES) -c $<

graphlist.o: graph.c $(top_srcdir)/getopt/getopt.h $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h extern.h
	$(CC) -c -DVERSION=\"$(VERSION)\" $(CFLAGS) -DLIST_FONTS $(INCLUDES) $(srcdir)/graph.c
	mv graph.o $@

graphnolist.o: graph.c $(top_srcdir)/getopt/getopt.h $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h extern.h
	$(CC) -c -DVERSION=\"$(VERSION)\" $(CFLAGS) $(INCLUDES) $(srcdir)/graph.c
	mv graph.o $@

graph: $(OBJSMINUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplot/libplot.a
	$(CC) $(CFLAGS) $(OBJSMINUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplot/libplot.a $(LIBS) $(LDFLAGS) -o $@

graph-tek: $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplottek/libplottek.a
	$(CC) $(CFLAGS) $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplottek/libplottek.a $(LIBS) $(LDFLAGS) -o $@

graph-fig: $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotfig/libplotfig.a
	$(CC) $(CFLAGS) $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotfig/libplotfig.a $(LIBS) $(LDFLAGS) -o $@

graph-ps: $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotps/libplotps.a
	$(CC) $(CFLAGS) $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotps/libplotps.a $(LIBS) $(LDFLAGS) -o $@

graph-X: $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotX/libplotX.a
	$(CC) $(CFLAGS) $(X_CFLAGS) $(OBJSPLUS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotX/libplotX.a $(X_LIBS) $(X_PRE_LIBS) $(XLIBS) $(X_EXTRA_LIBS) $(LIBS) $(LDFLAGS) -o $@;

../libs/libplot/libplot.a:
	cd ../libs/libplot; $(MAKE) libplot.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplottek/libplottek.a:
	cd ../libs/libplottek; $(MAKE) libplottek.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplotfig/libplotfig.a:
	cd ../libs/libplotfig; $(MAKE) libplotfig.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplotps/libplotps.a:
	cd ../libs/libplotps; $(MAKE) libplotps.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplotX/libplotX.a:
	cd ../libs/libplotX; $(MAKE) libplotX.a CC="$(CC)" CFLAGS="$(CFLAGS)" X_CFLAGS="$(X_CFLAGS)"

$(GETOPT)/getopt.o $(GETOPT)/getopt1.o: $(top_srcdir)/getopt/getopt.c $(top_srcdir)/getopt/getopt1.c
	cd $(GETOPT); $(MAKE) all CC="$(CC)" CFLAGS="$(CFLAGS)"

install: $(GRAPH)
	$(top_srcdir)/mkdirs.sh $(bindir)
	for f in $(GRAPH) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; \
	done; \
	if test "$(NO_X)" != "yes"; then $(MAKE) install-X; fi

install-X: $(GRAPHX)
	$(top_srcdir)/mkdirs.sh $(bindir)
	for f in $(GRAPHX) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; done

uninstall:
	-for f in $(GRAPH) ; do rm -f $(bindir)/$$f ; done
	-for f in $(GRAPHX) ; do rm -f $(bindir)/$$f ; done

clean:
	-rm -f *.o $(GRAPH) $(GRAPHX) core test* data*

distclean: clean
	-rm -f \#* *~ TAGS Makefile

realclean: distclean

TAGS: $(SRCS) $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(srcdir)/extern.h $(top_srcdir)/getopt/getopt.h
	cd $(srcdir) && etags $(SRCS) ../include/sys-defines.h ../include/plot.h extern.h ../getopt/getopt.h

######################################################################
# dependencies generated by gcc -c -MM *.c -I etc.
######################################################################

graph.o: graph.c $(top_srcdir)/getopt/getopt.h $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h extern.h
misc.o: misc.c $(top_srcdir)/include/sys-defines.h extern.h
reader.o: reader.c $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h extern.h
plotter.o: plotter.c $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h extern.h linemode.h
$(GETOPT)/getopt.o: $(top_srcdir)/getopt/getopt.h
$(GETOPT)/getopt1.o: $(top_srcdir)/getopt/getopt.h
