# This is the Makefile for plot2dev, a filter which translates plot(5)
# input to any of several output formats, depending on which plotting
# library is linked with it.  The input files may be in plot(5) format, or
# an ASCII variant of it.  plot2plot, plot2fig, plot2tek, and plot2ps are
# the executables.

VERSION = @VERSION@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH  = @srcdir@

SHELL = /bin/sh

CC = @CC@
CFLAGS = @CFLAGS@
X_CFLAGS = @X_CFLAGS@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
LDFLAGS = @LDFLAGS@
X_LIBS = @X_LIBS@
X_PRE_LIBS = @X_PRE_LIBS@
XLIBS = @XLIBS@
X_EXTRA_LIBS = @X_EXTRA_LIBS@
LIBS = @LIBS@
RANLIB = @RANLIB@
NO_X = @no_x@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
infodir = @infodir@
libdir = @libdir@
includedir = @includedir@
oldincludedir = @oldincludedir@

######################################################################

PLOT2DEV = plot2plot plot2tek plot2fig plot2ps
PLOT2DEVX = plot2X
GETOPT=../getopt

SRCS = plot.c
OBJS = plot.o

INCLUDES=-I.. -I$(top_srcdir)/include -I$(top_srcdir)/getopt

all: $(PLOT2DEV)
	if test "$(NO_X)" != "yes"; then \
			for i in $(PLOT2DEVX); do $(MAKE) $$i; done; \
	fi

.PHONY: all install uninstall clean realclean distclean

.SUFFIXES:
.SUFFIXES: .c .o

.c.o:
	$(CC) -DVERSION=\"$(VERSION)\" $(CFLAGS) $(INCLUDES) -c $<

plotlist.o: plot.c $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(top_srcdir)/getopt/getopt.h
	$(CC) -DVERSION=\"$(VERSION)\" -DLIST_FONTS $(CFLAGS) $(INCLUDES) -c $(srcdir)/plot.c
	mv plot.o $@

plotnolist.o: plot.c $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(top_srcdir)/getopt/getopt.h
	$(CC) -DVERSION=\"$(VERSION)\" $(CFLAGS) $(INCLUDES) -c $(srcdir)/plot.c
	mv plot.o $@

plot2X: plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotX/libplotX.a
	$(CC) $(CFLAGS) $(X_CFLAGS) plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotX/libplotX.a $(X_LIBS) $(X_PRE_LIBS) $(XLIBS) $(X_EXTRA_LIBS) $(LIBS) $(LDFLAGS) -o $@;

plot2ps: plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotps/libplotps.a
	$(CC) $(CFLAGS) plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotps/libplotps.a $(LIBS) $(LDFLAGS) -o $@

plot2fig: plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotfig/libplotfig.a
	$(CC) $(CFLAGS) plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotfig/libplotfig.a $(LIBS) $(LDFLAGS) -o $@

plot2tek: plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplottek/libplottek.a
	$(CC) $(CFLAGS) plotlist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplottek/libplottek.a $(LIBS) $(LDFLAGS) -o $@

plot2plot: plotnolist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplot/libplot.a
	$(CC) $(CFLAGS) plotnolist.o $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplot/libplot.a $(LIBS) $(LDFLAGS) -o $@

../libs/libplotX/libplotX.a:
	cd ../libs/libplotX; $(MAKE) libplotX.a CC="$(CC)" CFLAGS="$(CFLAGS)" X_CFLAGS="$(X_CFLAGS)"

../libs/libplotps/libplotps.a:
	cd ../libs/libplotps; $(MAKE) libplotps.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplotfig/libplotfig.a:
	cd ../libs/libplotfig; $(MAKE) libplotfig.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplottek/libplottek.a:
	cd ../libs/libplottek; $(MAKE) libplottek.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplot/libplot.a:
	cd ../libs/libplot; $(MAKE) libplot.a CC="$(CC)" CFLAGS="$(CFLAGS)"

$(GETOPT)/getopt.o $(GETOPT)/getopt1.o: $(top_srcdir)/getopt/getopt.c $(top_srcdir)/getopt/getopt1.c
	cd $(GETOPT); $(MAKE) all CC="$(CC)" CFLAGS="$(CFLAGS)"

install: $(PLOT2DEV)
	$(top_srcdir)/mkdirs.sh $(bindir)
	for f in $(PLOT2DEV) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; \
	done; \
	if test "$(NO_X)" != "yes"; then $(MAKE) install-X; fi

install-X: $(PLOT2DEVX)
	$(top_srcdir)/mkdirs.sh $(bindir)
	for f in $(PLOT2DEVX) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; done

uninstall:
	-for f in $(PLOT2DEV) ; do rm -f $(bindir)/$$f ; done
	-for f in $(PLOT2DEVX) ; do rm -f $(bindir)/$$f ; done

clean:
	-rm -f *.o $(PLOT2DEV) $(PLOT2DEVX) core test* data*

distclean: clean
	-rm -f \#* *~ TAGS Makefile

realclean: distclean

TAGS: $(SRCS) $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(top_srcdir)/getopt/getopt.h
	cd $(srcdir) && etags $(SRCS) ../include/sys-defines.h ../include/plot.h ../getopt/getopt.h

######################################################################
# dependencies generated by gcc -c -MM *.c -I etc.
######################################################################

plot.o: plot.c $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(top_srcdir)/getopt/getopt.h
