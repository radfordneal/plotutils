# This is the Makefile for tek2plot, a filter which translates Tektronix
# plot files to any of several output formats, depending on which plotting
# library is linked with it.  tek2plot, tek2tek, tek2fig, and
# tek2ps are the executables.

VERSION = @VERSION@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH  = @srcdir@

SHELL = /bin/sh

CC = @CC@
CFLAGS = @CFLAGS@
X_CFLAGS = @X_CFLAGS@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
LDFLAGS = @LDFLAGS@
X_LIBS = @X_LIBS@
X_PRE_LIBS = @X_PRE_LIBS@
XLIBS = @XLIBS@
X_EXTRA_LIBS = @X_EXTRA_LIBS@
LIBS = @LIBS@
RANLIB = @RANLIB@
NO_X = @no_x@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
infodir = @infodir@
libdir = @libdir@
includedir = @includedir@
oldincludedir = @oldincludedir@

######################################################################

TEK2PLOT = tek2plot tek2tek tek2fig tek2ps 
TEK2PLOTX = tek2X
GETOPT=../getopt

SRCS = tek2.c
OBJS = tek2.o

INCLUDES=-I.. -I$(top_srcdir)/include -I$(top_srcdir)/getopt

all: $(TEK2PLOT)
	if test "$(NO_X)" != "yes"; then \
			for i in $(TEK2PLOTX); do $(MAKE) $$i; done; \
	fi

.PHONY: all install uninstall clean realclean distclean

.SUFFIXES:
.SUFFIXES: .c .o

.c.o:
	$(CC) -DVERSION=\"$(VERSION)\" $(CFLAGS) $(INCLUDES) -c $<

tek2X: $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotX/libplotX.a
	$(CC) $(CFLAGS) $(X_CFLAGS) $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotX/libplotX.a $(X_LIBS) $(X_PRE_LIBS) $(XLIBS) $(X_EXTRA_LIBS) $(LIBS) $(LDFLAGS) -o $@

tek2ps: $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotps/libplotps.a
	$(CC) $(CFLAGS) $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotps/libplotps.a $(LIBS) $(LDFLAGS) -o $@

tek2fig: $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotfig/libplotfig.a
	$(CC) $(CFLAGS) $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplotfig/libplotfig.a $(LIBS) $(LDFLAGS) -o $@

tek2tek: $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplottek/libplottek.a
	$(CC) $(CFLAGS) $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplottek/libplottek.a $(LIBS) $(LDFLAGS) -o $@

tek2plot: $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplot/libplot.a
	$(CC) $(CFLAGS) $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o ../libs/libplot/libplot.a $(LIBS) $(LDFLAGS) -o $@

../libs/libplotX/libplotX.a:
	cd ../libs/libplotX; $(MAKE) libplotX.a CC="$(CC)" CFLAGS="$(CFLAGS)" X_CFLAGS="$(X_CFLAGS)"

../libs/libplotps/libplotps.a:
	cd ../libs/libplotps; $(MAKE) libplotps.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplotfig/libplotfig.a:
	cd ../libs/libplotfig; $(MAKE) libplotfig.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplottek/libplottek.a:
	cd ../libs/libplottek; $(MAKE) libplottek.a CC="$(CC)" CFLAGS="$(CFLAGS)"

../libs/libplot/libplot.a:
	cd ../libs/libplot; $(MAKE) libplot.a CC="$(CC)" CFLAGS="$(CFLAGS)"

$(GETOPT)/getopt.o $(GETOPT)/getopt1.o: $(top_srcdir)/getopt/getopt.c $(top_srcdir)/getopt/getopt1.c
	cd $(GETOPT); $(MAKE) all CC="$(CC)" CFLAGS="$(CFLAGS)"

install: $(TEK2PLOT)
	$(top_srcdir)/mkdirs.sh $(bindir)
	for f in $(TEK2PLOT) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; \
	done; \
	if test "$(NO_X)" != "yes"; then $(MAKE) install-X; fi

install-X: $(TEK2PLOTX)
	$(top_srcdir)/mkdirs.sh $(bindir)
	for f in $(TEK2PLOTX) ; do $(INSTALL_PROGRAM) $$f $(bindir)/$$f ; done

uninstall:
	-for f in $(TEK2PLOT) ; do rm -f $(bindir)/$$f ; done
	-for f in $(TEK2PLOTX) ; do rm -f $(bindir)/$$f ; done

clean:
	-rm -f *.o $(TEK2PLOT) $(TEK2PLOTX) ts core test* data*

distclean: clean
	-rm -f \#* *~ TAGS Makefile

realclean: distclean

TAGS: $(SRCS) $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(top_srcdir)/getopt/getopt.h
	cd $(srcdir) && etags $(SRCS) ../include/sys-defines.h ../include/plot.h ../getopt/getopt.h

######################################################################
# dependencies generated by gcc -c -MM *.c -I etc.
######################################################################

tek2.o: tek2.c $(top_srcdir)/include/sys-defines.h $(top_srcdir)/include/plot.h $(top_srcdir)/getopt/getopt.h
