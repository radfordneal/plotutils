# This is the Makefile for ode.

VERSION = @VERSION@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH  = @srcdir@

SHELL = /bin/sh

CC = @CC@
CFLAGS = @CFLAGS@
X_CFLAGS = @X_CFLAGS@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
ALLOCA = @ALLOCA@
RANLIB = @RANLIB@
LEX = @LEX@
YACC = @YACC@
LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
LEXLIB = @LEXLIB@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
infodir = @infodir@
libdir = @libdir@
includedir = @includedir@
oldincludedir = @oldincludedir@
mandir = @mandir@

######################################################################

PROGRAM = ode

SRCS = am.c ama.c bessel.c eu.c expr.c float.c global.c main.c misc.c \
prt.c rk.c rka.c specfun.c stperr.c sym.c xmalloc.c yywrap.c

OBJS = gram.o lex.o am.o ama.o bessel.o expr.o eu.o float.o global.o main.o \
misc.o prt.o rk.o rka.o specfun.o sym.o stperr.o xmalloc.o yywrap.o

INCLUDES=-I$(srcdir) -I.. -I$(top_srcdir)/include -I$(top_srcdir)/getopt

GETOPT=../getopt

all: $(PROGRAM)

.PHONY: all install uninstall clean realclean distclean

.SUFFIXES:
.SUFFIXES: .c .o

.c.o:
	$(CC) -DVERSION=\"$(VERSION)\" $(CFLAGS) $(INCLUDES) -c $<

$(PROGRAM): $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o $(ALLOCA)
	$(CC) $(CFLAGS) $(OBJS) $(GETOPT)/getopt.o $(GETOPT)/getopt1.o $(LEXLIB) $(LIBS) $(ALLOCA) $(LDFLAGS) -o $@

gram.o:	gram.c $(top_srcdir)/include/sys-defines.h ode.h extern.h

gram.c gram.tab.h:	gram.y
	$(YACC) -d $(srcdir)/gram.y
	mv y.tab.c gram.c
	mv y.tab.h gram.tab.h

lex.o: lex.c $(top_srcdir)/include/sys-defines.h ode.h extern.h gram.tab.h

lex.c:	lex.l
	$(LEX) $(srcdir)/lex.l
	mv $(LEX_OUTPUT_ROOT).c lex.c

$(GETOPT)/getopt.o $(GETOPT)/getopt1.o: $(top_srcdir)/getopt/getopt.c $(top_srcdir)/getopt/getopt1.c
	cd $(GETOPT); $(MAKE) all CC="$(CC)" CFLAGS="$(CFLAGS)"

install: $(PROGRAM)
	$(top_srcdir)/mkdirs.sh $(bindir)
	$(INSTALL_PROGRAM) $(PROGRAM) $(bindir)/$(PROGRAM)

install-man: $(PROGRAM).man
	$(top_srcdir)/mkdirs.sh $(mandir) $(mandir)/man1
	-$(INSTALL_DATA) $(srcdir)/$(PROGRAM).man $(mandir)/man1/$(PROGRAM).1

uninstall:
	-rm -f $(bindir)/$(PROGRAM)
	-rm -f $(mandir)/man1/$(PROGRAM).1

clean:
	-rm -f *.o $(PROGRAM) core test* data*

distclean: clean
	-rm -f \#* *~ TAGS Makefile

realclean: distclean
	-rm -f gram.c gram.tab.h lex.c

TAGS: $(SRCS) $(top_srcdir)/include/sys-defines.h ode.h extern.h num.h
	cd $(srcdir) && etags $(SRCS) ../include/sys-defines.h ode.h extern.h num.h

######################################################################
# dependencies generated by gcc -c -MM *.c -I etc.
######################################################################

am.o: am.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
ama.o: ama.c $(top_srcdir)/include/sys-defines.h ode.h num.h extern.h
bessel.o: bessel.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
eu.o: eu.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
expr.o: expr.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
float.o: float.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
global.o: global.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
main.o: main.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
misc.o: misc.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
prt.o: prt.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
rk.o: rk.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
rka.o: rka.c $(top_srcdir)/include/sys-defines.h ode.h num.h extern.h
specfun.o: specfun.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
stperr.o: stperr.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
sym.o: sym.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
xmalloc.o: xmalloc.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
yywrap.o: yywrap.c $(top_srcdir)/include/sys-defines.h ode.h extern.h
